# yt_audio_downloader

Простая программа для скачивания аудио из видео или плейлистов YouTube.

## Возможности

- Поддерживает скачивание аудио из видео, плейлистов, канала.
- Поддерживает аудио форматы: `mp3`, `opus`, `m4a`
- Встраивание миниатюр и метаданных в аудиофайлы (если доступны)
- Гибкий фильтр по дате загрузки для скачиваемых файлов

## Установка для Linux

1. Установите системные зависимости:
    ```bash
    sudo dnf install ffmpeg
    ```

2. Клонируйте репозиторий:
    ```bash
    git clone <ссылка на репозиторий>
    ```
   
3.  Перейдите в репозиторий и установите виртуальное окружение в нем:
    ```bash
    python3 -m venv --copies .venv
    source .venv/bin/activate
    unset all_proxy && unset ALL_PROXY
    pip install --upgrade pip
    ```

4. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```

## Использование

Вначале обязательно создайте и настройте файл `.env` файл с конфигурацией. Затем,
запустите скрипт `run.sh` с указанием ссылки на видео или плейлист:

```bash
# Видео (Лимит 10000 запросов в сутки)
./run.sh https://www.youtube.com/watch?v=6OaTvs07k5U

# Плейлист (Лимит 10000 запросов в сутки)
./run.sh https://youtube.com/playlist?list=PL-adxGZ1y-OXzOAXG5gB0pF5g5Pw7jBEG&feature=shared

# Канал (Лимит 100 запросов в сутки)
./run.sh https://www.youtube.com/@808nation
```

Программа автоматически определит, что именно вы хотите скачать (видео или плейлист).
Все загруженные видео на канал, находятся в плейлисте `uploads`, поэтому когда, 
передается ссылка на канал, она обрабатывается как плейлист. 

## Настройки

Все параметры настраиваются через файл `.env`. Создайте файл .env в корневом каталоге
проекта и добавьте необходимые переменные среды. Пример файла `.env` в `.env.example`.
Для работы программы нужен будет api ключ, который можно получить 
тут [Google Cloud Console](https://console.cloud.google.com/). Промт для chatgpt:
Получение API ключа YouTube Data API.

```ini
#[api]
# Этот ключ не действителен, и указан для примера. Без api ключа, программа 
# не будет работать.
API_KEY_YOUTUBE = "ABQsY0Yd8tc1vw8FfvIcgt7PV9ue35v1o1BoBCb"
# API Google
ENDPOINT = "https://www.googleapis.com/youtube/v3"

#[download]
# Формат аудиофайлов ("mp3", "opus", "m4a", ""). Если не указан, выбирает лучшее.
AUDIO_EXT = ""
# Формат выходного файла
FILENAME_FORMAT = "%(title)s.%(ext)s"
# Скачивать метаданные ("True" или "False")
WRITE_THUMBNAIL = "TRUE"
# Скачивать миниатюры ("True" или "False")
WRITE_METADATA = "TRUE"
# Уменьшить миниатюру до какой-то ширины ("True" или "False"). Обложки
# могут быть большими, что будет раздувать размер выходного файла.
THUMBNAIL_RESIZE = "TRUE"
THUMBNAIL_MAX_WIDTH = "350"
# Пропускать видео формата shorts при загрузке или нет.
SKIP_SHORTS="TRUE"
# Директория, куда будут загружаться файлы.
DOWNLOAD_DIRECTORY = "/home/blxnk/Downloads/YouTube"

#[extended]
# Включает расширенный лог в консоли.
DEBUG_MODE = "FALSE"
# Фильтр по дате загрузки. Если не указан, не применяет фильтр.
FILTER_DATE = ""
```

## Подробное описание параметров `.env` с примерами.

Файл должен находиться в корневой директории проекта.

### [api]

- **API_KEY_YOUTUBE**: Ключ API для доступа к YouTube Data API.
    - Этот ключ используется для выполнения запросов к API, например, для получения 
      информации о видео. YouTube Data API имеет ограничения в виде условной стоимости 
      каждой операции, исчисляемой в единицах, ежедневный лимит составляет 
      **10,000 единиц**. Моя программа использует три типа запросов.
    - **Операции и их стоимость (прайс)**:
      - Запрос к видео — **1 единица**.
      - Запрос плейлиста — **1 единица**.
      - Получение всех видео с канала (по названию канала) — **100 единиц** 
        (максимум 100 запросов в сутки).
    - При превышении лимита в 10,000 единиц в течение дня, запросы к API временно 
      перестанут работать до восстановления лимита на следующий день.
    
    - Пример использования:  
      `API_KEY_YOUTUBE="ABQsY0Yd8tc1vw8FfvIcgt7PV9ue35v1o1BoBCb"`


- **ENDPOINT:** Базовый URL для запросов к YouTube Data API.
    - Этот URL используется в комбинации с различными методами API для получения нужных
      данных.
    - Пример: `ENDPOINT="https://www.googleapis.com/youtube/v3"`

### [download]

- **AUDIO_EXT:** Конечный контейнер для аудио файлов (поддерживаются: opus, mp3, m4a).
    - Если указать пустые кавычки `""`, будет использован параметр `"bestaudio/best"`,
      и файлы будут сохранены в лучшем доступном качестве без перекодирования, с
      расширением `.opus` или `.m4a`.
    - Пример: `AUDIO_EXT=""`


- **FILENAME_FORMAT:** Формат имени выходного файла.
    - Пример: `FILENAME_FORMAT="%(title)s.%(ext)s"`


- **WRITE_THUMBNAIL:** Сохранять миниатюры видео.
    - Пример: `WRITE_THUMBNAIL="TRUE"`


- **WRITE_METADATA:** Сохранять метаданные (такие как теги, название и т.д.).
    - Пример: `WRITE_METADATA="TRUE"`


- **THUMBNAIL_RESIZE:** Конвертировать миниатюру в изображение меньшего размера.
    - Пример: `THUMBNAIL_RESIZE="TRUE"`


- **THUMBNAIL_MAX_WIDTH:** Максимальная ширина изображения после изменения размера.
    - Пример: `THUMBNAIL_MAX_WIDTH="350"`


- **SKIP_SHORTS:** Пропускать при загрузке видео (shorts) продолжительностью менее 
  60 секунд.
    - Пример: `SKIP_SHORTS="TRUE"`


- **DOWNLOAD_DIRECTORY:** Путь, куда будут загружаться все файлы (
  например, `/home/user/Downloads/YouTube`). Если указать как "", будет сохранять
  скачанные файлы в корневой директории программы "./YouTube"
    - Пример: `DOWNLOAD_DIRECTORY="/home/blxnk/Downloads/YouTube"`

### [extended]

- **DEBUG_MODE:** Включает расширенный форматтер логов и уровень логирования DEBUG, если
  установлено в `"TRUE"`.
    - Пример: `DEBUG_MODE="FALSE"`


- **FILTER_DATE:**
    - **Описание:** Переменная `FILTER_DATE` определяет фильтр для отбора данных на основе
      заданного условия, связанного с датой. Если значение установлено пустым `""`,
      фильтрация по дате не выполняется, и все данные будут обработаны без ограничений по
      дате.
    - **Примеры допустимых значений:**
        - `"2017 < [x] <= 2024"`  (отбирает данные между 2018 и 2024 годами включительно)
        - `"([x] <= 2017) or ([x] >= 2020)"` (отбирает все, исключая 2018 и 2019 годы)
        - `"[x] >= 2017"` (отбирает данные начиная с 2017 года)
        - `"[x] == 2024"`  (отбирает данные только за 2024 год)
        - `"[x] in {2017, 2019, 2023}"`  (отбирает данные за указанные годы)
        - `""` (отсутствие фильтрации по дате)
    - **Внимание:** Выражение должно быть корректным с точки зрения синтаксиса
      функции `eval` из Python. В случае ошибки будет выведено сообщение, и фильтр
      применен не будет.
    - **Список допустимых символов для выражения:** `0123456789x(){}[],!<>=orandnotin`
    - Пример: `FILTER_DATE="[x] >= 2017"`
